<!-- blog/templates/blog/category.html -->
{% extends 'base.html' %}

{% block title %}{{ category.name }} - Blog - Dating Hub Research{% endblock %}

{% block content %}
<div class="blog-header">
    <div class="content-container">
        <h1>{{ category.name }}</h1>
        {% if category.description %}
        <p class="lead">{{ category.description }}</p>
        {% else %}
        <p class="lead">All posts in the {{ category.name }} category.</p>
        {% endif %}
    </div>
</div>

<div class="blog-container">
    <main class="blog-main">
        {% if page_obj.object_list %}
            <div class="posts-count" style="margin-bottom: 2rem; color: #767676;">
                Showing {{ page_obj.paginator.count }} post{{ page_obj.paginator.count|pluralize }}
            </div>
            
            {% for post in page_obj.object_list %}
            <article class="blog-post-card">
                {% if post.featured_image %}
                <div class="blog-post-image">
                    <img src="{{ post.featured_image.url }}" alt="{{ post.title }}">
                </div>
                {% endif %}
                <div class="blog-post-content">
                    <div class="blog-post-meta">
                        <a href="{% url 'blog:blog_category' post.category %}" class="blog-post-category">
                            {{ post.get_category_display }}
                        </a>
                        <span><i class="bi bi-calendar"></i> {{ post.published_date|date:"F j, Y" }}</span>
                        <span><i class="bi bi-person"></i> {{ post.author.get_full_name|default:post.author.username }}</span>
                        <span><i class="bi bi-clock"></i> {{ post.estimated_read_time }} min read</span>
                    </div>
                    <h2 class="blog-post-title">
                        <a href="{% url 'blog:blog_detail' post.slug %}">{{ post.title }}</a>
                    </h2>
                    <p class="blog-post-excerpt">{{ post.excerpt }}</p>
                    <div class="blog-post-footer">
                        <a href="{% url 'blog:blog_detail' post.slug %}" class="cta-button" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                            Read More <i class="bi bi-arrow-right"></i>
                        </a>
                        <div class="blog-post-stats">
                            <span><i class="bi bi-eye"></i> {{ post.views }} views</span>
                        </div>
                    </div>
                </div>
            </article>
            {% endfor %}
            
            <!-- Pagination -->
            {% if page_obj.has_other_pages %}
            <nav class="pagination">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}" class="page-link">
                    <i class="bi bi-chevron-left"></i> Previous
                </a>
                {% else %}
                <span class="page-link disabled">
                    <i class="bi bi-chevron-left"></i> Previous
                </span>
                {% endif %}
                
                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <span class="page-link active">{{ num }}</span>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="?page={{ num }}" class="page-link">{{ num }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="page-link">
                    Next <i class="bi bi-chevron-right"></i>
                </a>
                {% else %}
                <span class="page-link disabled">
                    Next <i class="bi bi-chevron-right"></i>
                </span>
                {% endif %}
            </nav>
            {% endif %}
            
        {% else %}
        <div class="empty-state">
            <i class="bi bi-folder-x"></i>
            <h3>No posts in this category yet</h3>
            <p>Check back soon for new articles in {{ category.name }}.</p>
            <a href="{% url 'blog:index' %}" class="cta-button">
                View All Posts <i class="bi bi-arrow-right"></i>
            </a>
        </div>
        {% endif %}
    </main>
    
    <aside class="blog-sidebar">
        <!-- Back to Blog -->
        <div class="sidebar-widget">
            <h3><i class="bi bi-arrow-left"></i> Navigation</h3>
            <a href="{% url 'blog:index' %}" class="cta-button" style="width: 100%; text-align: center; margin-bottom: 1rem;">
                <i class="bi bi-house"></i> Back to Blog
            </a>
            <a href="{% url 'research_index' %}" class="cta-button cta-button-secondary" style="width: 100%; text-align: center;">
                <i class="bi bi-journal-text"></i> Research Studies
            </a>
        </div>
        
        <!-- Categories Widget -->
        <div class="sidebar-widget">
            <h3><i class="bi bi-folder"></i> All Categories</h3>
            <ul class="categories-list">
                {% for cat in categories %}
                <li>
                    <a href="{% url 'blog:blog_category' cat.slug %}" {% if cat.id == category.id %}style="color: #0066CC; font-weight: 600;"{% endif %}>
                        {{ cat.name }}
                        <span class="category-count">{{ cat.post_count }}</span>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        
        <!-- Recent Posts Widget -->
        <div class="sidebar-widget">
            <h3><i class="bi bi-clock-history"></i> Recent Posts</h3>
            {% for recent in recent_posts %}
            <div class="recent-post">
                {% if recent.featured_image %}
                <div class="recent-post-image">
                    <img src="{{ recent.featured_image.url }}" alt="{{ recent.title }}">
                </div>
                {% endif %}
                <div class="recent-post-content">
                    <h4 class="recent-post-title">
                        <a href="{% url 'blog:blog_detail' recent.slug %}">{{ recent.title|truncatechars:50 }}</a>
                    </h4>
                    <div class="recent-post-meta">
                        {{ recent.published_date|date:"M j, Y" }}
                    </div>
                </div>
            </div>
            {% empty %}
            <p style="color: #767676; font-style: italic;">No recent posts</p>
            {% endfor %}
        </div>
    </aside>
</div>
{% endblock %}
